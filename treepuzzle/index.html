<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Leaf Cutout Game</title>
  <style>
    canvas {
      border: 1px solid black;
      display: block;
      margin: 20px auto;
    }
  </style>
</head>
<body>
  <canvas id="canvas" width="800" height="600"></canvas>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');

    // List of trees
    const treeNames = ['alder', 'ash', 'birch', 'chestnut', 'oak', 'pine', 'willow'];

    // Function to load one image
    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    // Load all tree and leaf images
    async function loadAllImages() {
      const images = {};

      for (const name of treeNames) {
        images[name] = await loadImage(`${name}.png`);
        images[`${name}leaf`] = await loadImage(`${name}leaf.png`);
      }

      return images;
    }

    // Create a masked version of the tree with a transparent leaf-shaped hole
    function createMaskedTree(treeImg, leafImg) {
      const offCanvas = document.createElement('canvas');
      offCanvas.width = treeImg.width;
      offCanvas.height = treeImg.height;
      const offCtx = offCanvas.getContext('2d');

      // Draw the tree first
      offCtx.drawImage(treeImg, 0, 0);

      // Set compositing to remove the leaf shape from the tree
      offCtx.globalCompositeOperation = 'destination-out';
      offCtx.drawImage(leafImg, 0, 0);

      // Reset compositing
      offCtx.globalCompositeOperation = 'source-over';

      return offCanvas;
    }

    // Main drawing logic
    async function main() {
      const images = await loadAllImages();

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      const gap = 20;
      let x = gap;
      let y = gap;

      for (const name of treeNames) {
        const tree = images[name];
        const leaf = images[`${name}leaf`];
        const maskedTree = createMaskedTree(tree, leaf);

        // Draw masked tree
        ctx.drawImage(maskedTree, x, y);

        // Draw the leaf in the same position (to "fill in" the hole)
        ctx.drawImage(leaf, x, y);

        x += tree.width + gap;
        if (x + tree.width > canvas.width) {
          x = gap;
          y += tree.height + gap;
        }
      }
    }

    main().catch(err => console.error('Error loading images:', err));
  </script>
</body>
</html>
