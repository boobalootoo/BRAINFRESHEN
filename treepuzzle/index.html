<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Leaf Cutout Masking</title>
  <style>
    body {
      display: flex;
      gap: 20px;
      background: #f0f0f0;
      padding: 20px;
    }
    canvas {
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <script>
    const trees = ['pine', 'oak', 'maple'];

    const treeImages = {};
    const leafMasks = {};
    const leafFills = {};

    const loadImage = (src) => {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.src = src;
        img.onload = () => resolve(img);
        img.onerror = reject;
      });
    };

    async function loadAllImages() {
      try {
        for (const tree of trees) {
          treeImages[tree] = await loadImage(`${tree}.png`);
          leafMasks[tree] = await loadImage(`${tree}_leaf.png`);
          leafFills[tree] = await loadImage(`${tree}_leaf.png`); // Using same image to fill the gap
        }
        drawMaskedTrees();
      } catch (err) {
        console.error('Failed to load images', err);
      }
    }

    function drawMaskedTrees() {
      trees.forEach(tree => {
        const treeImg = treeImages[tree];
        const leafMask = leafMasks[tree];
        const leafFill = leafFills[tree];

        const canvas = document.createElement('canvas');
        canvas.width = treeImg.width;
        canvas.height = treeImg.height;
        const ctx = canvas.getContext('2d');

        // Draw tree image
        ctx.drawImage(treeImg, 0, 0);

        // Set composite mode to 'destination-out' to punch a hole
        ctx.globalCompositeOperation = 'destination-out';
        ctx.drawImage(leafMask, 0, 0);

        // Reset mode and draw the leaf behind the cutout
        ctx.globalCompositeOperation = 'destination-over';
        ctx.drawImage(leafFill, 0, 0);

        // Add canvas to page
        document.body.appendChild(canvas);
      });
    }

    loadAllImages();
  </script>
</body>
</html>
