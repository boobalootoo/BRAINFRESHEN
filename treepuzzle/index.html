<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Tree Cutout Matching</title>
  <style>
    body {
      background: #cce;
      font-family: sans-serif;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      padding: 20px;
    }
    canvas {
      border: 2px solid #333;
      background: white;
    }
  </style>
</head>
<body>
  <script>
    const treeData = [
      { tree: "pine", leaf: "needle" },
      { tree: "oak", leaf: "oakleaf" },
      { tree: "maple", leaf: "mapleleaf" }
    ];

    const imagePath = name => `images/${name}.png`;

    // Load a single image and return a promise
    function loadImage(src) {
      return new Promise((resolve, reject) => {
        const img = new Image();
        img.onload = () => resolve(img);
        img.onerror = reject;
        img.src = src;
      });
    }

    // Load both tree and leaf images for each item
    async function loadAllTreeLeafPairs() {
      return Promise.all(treeData.map(async ({ tree, leaf }) => {
        const treeImg = await loadImage(imagePath(tree));
        const leafImg = await loadImage(imagePath(leaf));
        return { tree, leaf, treeImg, leafImg };
      }));
    }

    function drawMaskedTree({ treeImg, leafImg }) {
      const w = treeImg.width;
      const h = treeImg.height;

      const canvas = document.createElement('canvas');
      canvas.width = w;
      canvas.height = h;
      const ctx = canvas.getContext('2d');

      // Draw tree image
      ctx.drawImage(treeImg, 0, 0);

      // Use an offscreen canvas to make a mask
      const maskCanvas = document.createElement('canvas');
      maskCanvas.width = w;
      maskCanvas.height = h;
      const maskCtx = maskCanvas.getContext('2d');

      // Fill mask fully white (visible)
      maskCtx.fillStyle = "white";
      maskCtx.fillRect(0, 0, w, h);

      // Draw the leaf onto the mask as black (cutout area)
      maskCtx.globalCompositeOperation = "destination-out";
      const centerX = (w - leafImg.width) / 2;
      const centerY = (h - leafImg.height) / 2;
      maskCtx.drawImage(leafImg, centerX, centerY);

      // Apply the mask to the tree image
      ctx.globalCompositeOperation = "destination-in";
      ctx.drawImage(maskCanvas, 0, 0);

      document.body.appendChild(canvas);
    }

    async function start() {
      try {
        const pairs = await loadAllTreeLeafPairs();
        pairs.forEach(drawMaskedTree);
      } catch (e) {
        console.error("Failed to load images", e);
      }
    }

    start();
  </script>
</body>
</html>

