<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Full Body Block Tracker</title>
<style>
  body { margin:0; font-family:sans-serif; background:#111; color:#fff; display:flex; flex-direction:column; align-items:center; }
  #videoContainer { position:relative; width:100%; max-width:400px; }
  video { width:100%; height:auto; transform:scaleX(-1); }
  svg { position:absolute; top:0; left:0; width:100%; height:100%; pointer-events:none; }
  rect { fill:rgba(255,255,255,0.7); stroke:#000; stroke-width:2; rx:6; ry:6; }
</style>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.10.0"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/pose-detection"></script>
<script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs-backend-webgl"></script>
</head>
<body>

<h2>Block Body Tracker</h2>
<div id="videoContainer">
  <video id="video" autoplay playsinline></video>
  <svg id="overlay"></svg>
</div>

<script>
(async function(){
  const video = document.getElementById('video');
  const overlay = document.getElementById('overlay');

  // Start camera
  try {
    const stream = await navigator.mediaDevices.getUserMedia({
      video: { facingMode: "environment" }, audio: false
    });
    video.srcObject = stream;
  } catch (e) {
    alert("Camera error: " + e.message);
    return;
  }

  // Load pose detector
  const detector = await poseDetection.createDetector(
    poseDetection.SupportedModels.MoveNet,
    { modelType: poseDetection.movenet.modelType.SINGLEPOSE_LIGHTNING }
  );

  function addBlock(x, y, w, h) {
    const rect = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
    rect.setAttribute('x', x - w/2);
    rect.setAttribute('y', y - h/2);
    rect.setAttribute('width', w);
    rect.setAttribute('height', h);
    overlay.appendChild(rect);
  }

  function drawBlocks(landmarks) {
    overlay.innerHTML = '';
    const scaleX = overlay.clientWidth / video.videoWidth;
    const scaleY = overlay.clientHeight / video.videoHeight;

    function sx(x){ return x * scaleX; }
    function sy(y){ return y * scaleY; }

    const nose = landmarks[0];
    const leftEye = landmarks[1], rightEye = landmarks[2];
    const leftShoulder = landmarks[5], rightShoulder = landmarks[6];
    const leftElbow = landmarks[7], rightElbow = landmarks[8];
    const leftWrist = landmarks[9], rightWrist = landmarks[10];
    const leftHip = landmarks[11], rightHip = landmarks[12];
    const leftKnee = landmarks[13], rightKnee = landmarks[14];
    const leftAnkle = landmarks[15], rightAnkle = landmarks[16];

    // Head
    if (nose && leftEye && rightEye) {
      const headW = Math.abs(sx(leftEye.x)-sx(rightEye.x)) * 3;
      addBlock(sx(nose.x), sy(nose.y)-40, headW, headW*1.2);
    }

    // Chest
    if (leftShoulder && rightShoulder) {
      const chestX = (sx(leftShoulder.x)+sx(rightShoulder.x))/2;
      const chestY = (sy(leftShoulder.y)+sy(rightShoulder.y))/2;
      const chestW = Math.abs(sx(leftShoulder.x)-sx(rightShoulder.x)) * 2;
      addBlock(chestX, chestY+30, chestW, 80);
    }

    // Waist (between hips)
    if (leftHip && rightHip) {
      const waistX = (sx(leftHip.x)+sx(rightHip.x))/2;
      const waistY = (sy(leftHip.y)+sy(rightHip.y))/2;
      const waistW = Math.abs(sx(leftHip.x)-sx(rightHip.x))*1.3;
      addBlock(waistX, waistY, waistW, 60);
    }

    // Arms
    if (leftShoulder && leftElbow) addBlock(sx(leftElbow.x), sy(leftElbow.y), 40, 60);
    if (rightShoulder && rightElbow) addBlock(sx(rightElbow.x), sy(rightElbow.y), 40, 60);
    if (leftElbow && leftWrist) addBlock(sx(leftWrist.x), sy(leftWrist.y), 30, 50);
    if (rightElbow && rightWrist) addBlock(sx(rightWrist.x), sy(rightWrist.y), 30, 50);

    // Legs
    if (leftHip && leftKnee) addBlock(sx(leftKnee.x), sy(leftKnee.y), 40, 70);
    if (rightHip && rightKnee) addBlock(sx(rightKnee.x), sy(rightKnee.y), 40, 70);
    if (leftKnee && leftAnkle) addBlock(sx(leftAnkle.x), sy(leftAnkle.y), 30, 60);
    if (rightKnee && rightAnkle) addBlock(sx(rightAnkle.x), sy(rightAnkle.y), 30, 60);

    // Feet
    if (leftAnkle) addBlock(sx(leftAnkle.x), sy(leftAnkle.y)+20, 20, 20);
    if (rightAnkle) addBlock(sx(rightAnkle.x), sy(rightAnkle.y)+20, 20, 20);
  }

  async function poseLoop() {
    const poses = await detector.estimatePoses(video);
    if (poses.length > 0) {
      drawBlocks(poses[0].keypoints);
    }
    requestAnimationFrame(poseLoop);
  }

  poseLoop();
})();
</script>

</body>
</html>
